<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/aop
    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">

    <aop:aspectj-autoproxy/>

    <!-- monitoMe is the bean we will monitor -->
    <bean id="monitorMe" class="org.automon.spring_aop.MonitorMe"/>
    <bean id="automonSpringAspect" class="org.automon.aspects.AutomonSpringAspect"/>
    <bean id="traceSpringAspect" class="org.automon.spring_aop.SpringTraceAspect"/>
    <bean id="baseAspect" class="org.automon.spring_aop.BasicContextTracingAspect" abstract="true" />
    <bean id="abstractSpringTraceAspect" class="org.automon.spring_aop.AbstractSpringTraceAspect" abstract="true" />

    <bean id="delmeAspect" class="org.automon.spring_aop.Delme"/>



    <!--    <bean id="concreteTracingAspect" class="org.automon.spring_aop.ConcreteTracingAspect" parent="abstractTracingAspect"/>-->

    <!-- Link the Automon Aspect to any beans you want monitored. Copy this into your applicationContext.xml and
     Define 'monitoredMethods' and 'exceptionTrackedMethods' pointcuts.
       - 'monitoredMethods' is a pointcut that tracks execution time of the methods.
       - 'exceptionTrackedMethods' is a pointcut that tracks any exceptions that are thronw.
     Typically both of these pointcuts would be the same though they don't need to be.

     There are many ways of defining aspectJ pointcut syntax.  For example annotations or packages
     can be specified. You can also use the '||' conditional to monitor many beans.

     Example1: <aop:pointcut id="monitoredMethods" expression="bean(monitorMe)"/>
     Example2: <aop:pointcut id="monitoredMethods" expression="bean(monitorMe4) || bean(monitorMe3)"/>
    -->

    <aop:config>
        <aop:pointcut id="monitoredMethods" expression="execution(* org.automon.spring_aop.MonitorMe.*(..))"/>
        <aop:pointcut id="exceptionTrackedMethods" expression="execution(* org.automon.spring_aop.MonitorMe.*(..))"/>

<!--        <aop:aspect ref="concreteTracingAspect">-->
<!--            <aop:pointcut id="trace" expression="execution(* org.automon.spring_aop.MonitorMe.myName(..))"/>-->
<!--        </aop:aspect>-->

<!--        // In your AspectJ aspect-->
<!--        @Around("trace()")-->
<!--        public Object myAroundAdvice(ProceedingJoinPoint joinPoint) throws Throwable {-->
<!--        // ...-->
<!--        }-->
<!--        // In your Spring AOP XML-->
<!--        <aop:around pointcut-ref="trace" method="myAroundAdvice"/>-->
<!--        -->
<!--        <aop:aspect id="concreteTracingAspect" ref="abstractSpringTraceAspect">-->
<!--            <aop:pointcut id="trace" expression="execution(* org.automon.spring_aop.MonitorMe.*(..))"/>-->
<!--        </aop:aspect>-->

        <aop:aspect id="concrete" ref="abstractSpringTraceAspect">
            <aop:pointcut id="trace" expression="execution(* org.automon.spring_aop.MonitorMe.*(..))"/>
            <aop:after-throwing pointcut-ref="exceptionTrackedMethods" method="afterThrowingAdvice" throwing="exception"/>
        </aop:aspect>

        <aop:aspect id="automonAspect" ref="automonSpringAspect">
            <aop:around pointcut-ref="monitoredMethods" method="monitor"/>
            <aop:after-throwing pointcut-ref="exceptionTrackedMethods" method="throwing" throwing="exceptionArg"/>
        </aop:aspect>
    </aop:config>

</beans>

